363,368d362
< setup_spamassassin() {
<     if [ -n "${SPAMASSASSIN_HOST}" ]; then
< 	set_config_value "smtpd_milters" "unix:/run/spamass-milter/socket"
<     fi
< }
< 
371c365
<     pid=$(/bin/pidof "$base")
---
>     pid=$(/usr/bin/ps -aux | /usr/bin/grep "$base" | /usr/bin/grep -v grep | /usr/bin/awk '{print $2}' | /usr/bin/tr '\n' ' ')
387,390d380
< stop_spamassassin() {
<     terminate /usr/sbin/spamass-milter
< }
< 
396c386
<     (   while ! pidof qmgr > /dev/null 2>&1 ; do
---
>     (   while ! (ps -aux | grep qmgr | grep -v grep | awk '{print $2}' | tr '\n' ' ') > /dev/null 2>&1; do
408d397
<     stop_spamassassin
427d415
< setup_spamassassin
433,440d420
< if [ "$1" = 'postfix' ]; then
<     if [ -n "${SPAMASSASSIN_HOST}" ]; then
< 	mkdir /run/spamass-milter
< 	chown sa-milter:postfix /run/spamass-milter
< 	chmod 751 /run/spamass-milter
< 	su sa-milter -s /bin/sh -c "/usr/sbin/spamass-milter -p /run/spamass-milter/socket -g postfix -f -- -d ${SPAMASSASSIN_HOST}"
<     fi
< fi
441a422
> echo "[info] refer to postfix manual pages at https://www.postfix.org/postfix-manuals.html"
